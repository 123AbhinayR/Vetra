{% extends "base.html" %}

{% block title %}{{ title }} - California Energy Map{% endblock %}

{% block extra_head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.min.js"></script>
<style>
    .chart-container {
        position: relative;
        height: 400px;
        width: 100%;
        margin: 20px 0;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .stat-card {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #1e40af;
    }
    
    .stat-label {
        color: #64748b;
        font-size: 0.9rem;
        margin-top: 5px;
    }
    
    .trend-indicator {
        display: inline-flex;
        align-items: center;
        margin-top: 5px;
        font-size: 0.8rem;
    }
    
    .trend-up { color: #10b981; }
    .trend-down { color: #ef4444; }
    .trend-stable { color: #6b7280; }
    
    .section-divider {
        border-bottom: 2px solid #e5e7eb;
        margin: 40px 0;
        padding-bottom: 20px;
    }
    
    .insight-box {
        background: #fef3c7;
        border-left: 4px solid #f59e0b;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 8px 8px 0;
    }
    
    .insight-title {
        font-weight: 600;
        color: #92400e;
        margin-bottom: 5px;
    }
    
    .filter-controls {
        display: flex;
        gap: 15px;
        margin: 20px 0;
        flex-wrap: wrap;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .filter-group label {
        font-size: 0.9rem;
        color: #374151;
        font-weight: 500;
    }
    
    .filter-group select, .filter-group input {
        padding: 8px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-white shadow overflow-hidden sm:rounded-lg">
    <div class="px-5 py-6 sm:px-6">
        <h1 class="text-3xl font-bold text-gray-900">Energy Analysis</h1>
        <p class="mt-2 max-w-3xl text-lg text-gray-500">Comprehensive analysis of California's renewable energy production and historical trends</p>
    </div>
    
    <div class="border-t border-gray-200 px-5 py-6 sm:p-6">
        
        <!-- Historical Data Analysis Section -->
        <div class="section-divider">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">📈 Historical Data Analysis & Trends</h2>
            
            <!-- Filter Controls -->
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="timeRange">Time Range</label>
                    <select id="timeRange">
                        <option value="1year">Last 12 Months</option>
                        <option value="2years">Last 24 Months</option>
                        <option value="5years" selected>Last 5 Years</option>
                        <option value="all">All Time</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="energyType">Energy Source</label>
                    <select id="energyType">
                        <option value="all" selected>All Sources</option>
                        <option value="solar">Solar Only</option>
                        <option value="wind">Wind Only</option>
                        <option value="hydro">Hydro Only</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="region">Region</label>
                    <select id="region">
                        <option value="all" selected>Statewide</option>
                        <option value="north">Northern California</option>
                        <option value="central">Central California</option>
                        <option value="south">Southern California</option>
                    </select>
                </div>
            </div>

            <!-- Key Statistics Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="avgGrowthRate">+12.4%</div>
                    <div class="stat-label">Annual Growth Rate</div>
                    <div class="trend-indicator trend-up">
                        ↗ +2.1% vs last year
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalCapacity">24,847</div>
                    <div class="stat-label">Total Capacity (MW)</div>
                    <div class="trend-indicator trend-up">
                        ↗ +1,892 MW added
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="efficiency">78.2%</div>
                    <div class="stat-label">Avg Efficiency</div>
                    <div class="trend-indicator trend-up">
                        ↗ +3.4% improvement
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="seasonalVar">±18.7%</div>
                    <div class="stat-label">Seasonal Variation</div>
                    <div class="trend-indicator trend-stable">
                        → Stable range
                    </div>
                </div>
            </div>

            <!-- Historical Capacity Growth Chart -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden p-6 mb-8">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">Renewable Energy Capacity Growth (2019-2024)</h4>
                <div class="chart-container">
                    <canvas id="capacityGrowthChart"></canvas>
                </div>
                <div class="insight-box">
                    <div class="insight-title">Key Insight:</div>
                    <p>Solar capacity has grown by 340% over the past 5 years, with the most significant expansion occurring in 2022-2023, driven by state incentives and falling panel costs.</p>
                </div>
            </div>

            <!-- Seasonal Performance Trends -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden p-6 mb-8">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">Seasonal Performance Patterns</h4>
                <div class="chart-container">
                    <canvas id="seasonalChart"></canvas>
                </div>
                <div class="insight-box">
                    <div class="insight-title">Seasonal Analysis:</div>
                    <p>Solar output peaks in summer months (June-August) with 45% higher generation, while wind power shows more consistent year-round performance with slight winter peaks.</p>
                </div>
            </div>

            <!-- Efficiency Trends Over Time -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden p-6 mb-8">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">Technology Efficiency Improvements</h4>
                <div class="chart-container">
                    <canvas id="efficiencyChart"></canvas>
                </div>
                <div class="insight-box">
                    <div class="insight-title">Technology Progress:</div>
                    <p>Average system efficiency has improved from 65% in 2019 to 78% in 2024, with newer installations achieving up to 85% efficiency through advanced inverters and optimized layouts.</p>
                </div>
            </div>

            <!-- Regional Performance Comparison -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden p-6 mb-8">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">Regional Performance Trends</h4>
                <div class="chart-container">
                    <canvas id="regionalChart"></canvas>
                </div>
                <div class="insight-box">
                    <div class="insight-title">Regional Insights:</div>
                    <p>Southern California leads in solar deployment (60% of state capacity), while Northern California dominates wind generation (72% of wind capacity) due to favorable geography.</p>
                </div>
            </div>

            <!-- Weather Impact Analysis -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden p-6 mb-8">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">Weather Impact on Generation</h4>
                <div class="chart-container">
                    <canvas id="weatherImpactChart"></canvas>
                </div>
                <div class="insight-box">
                    <div class="insight-title">Climate Correlation:</div>
                    <p>Generation shows strong correlation with seasonal weather patterns. Drought years (2020-2022) reduced hydro output by 32%, while record wind speeds in 2023 boosted wind generation by 28%.</p>
                </div>
            </div>

            <!-- Investment and Economic Trends -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden p-6 mb-8">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">Investment & Economic Impact Trends</h4>
                <div class="chart-container">
                    <canvas id="investmentChart"></canvas>
                </div>
                <div class="insight-box">
                    <div class="insight-title">Economic Impact:</div>
                    <p>Renewable energy investments have totaled $42.8 billion since 2019, creating an estimated 156,000 jobs and reducing electricity costs by an average of 18% statewide.</p>
                </div>
            </div>
        </div>

        <!-- Original Current Analysis Section -->
        <div class="section-divider">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">🔍 Current State Analysis</h2>
            
            <div class="w-full space-y-12 max-w-5xl mx-auto">
                <!-- Image 1 -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden p-6">
                    <h4 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Average Power Output by Energy Source</h4>
                    <div class="flex justify-center">
                        <img src="{{ url_for('static', filename='img/image1.jpg') }}" alt="Average Power Output by Energy Source" class="max-w-full h-auto rounded" style="max-height: 600px;">
                    </div>
                    <p class="mt-4 text-lg text-gray-600">Comparison of average power output between solar (SUN) and wind (WND) energy sources in California, showing wind's significantly higher average output.</p>
                </div>
                
                <!-- Image 2 -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden p-6">
                    <h4 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Temperature vs Solar Power Output</h4>
                    <div class="flex justify-center">
                        <img src="{{ url_for('static', filename='img/image2.png') }}" alt="Temperature vs Solar Power Output" class="max-w-full h-auto rounded" style="max-height: 600px;">
                    </div>
                    <p class="mt-4 text-lg text-gray-600">Scatter plot showing the relationship between temperature and solar power output, with points colored by cloud cover percentage, illustrating how these weather conditions affect solar efficiency.</p>
                </div>
                
                <!-- Image 3 -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden p-6">
                    <h4 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Wind Speed vs Wind Power Output</h4>
                    <div class="flex justify-center">
                        <img src="{{ url_for('static', filename='img/image3.png') }}" alt="Wind Speed vs Wind Power Output" class="max-w-full h-auto rounded" style="max-height: 600px;">
                    </div>
                    <p class="mt-4 text-lg text-gray-600">Scatter plot demonstrating the strong correlation between wind speed and power output, with point sizes representing different estimated output levels.</p>
                </div>
                
                <!-- Image 4 -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden p-6">
                    <h4 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Power Output Heatmap Across California</h4>
                    <div class="flex justify-center">
                        <img src="{{ url_for('static', filename='img/image4.jpg') }}" alt="Power Output Heatmap Across California" class="max-w-full h-auto rounded" style="max-height: 600px;">
                    </div>
                    <p class="mt-4 text-lg text-gray-600">Geographic heatmap showing the distribution and intensity of renewable energy production across California, with blue dots representing individual plant locations.</p>
                </div>
                
                <!-- Image 5 -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden p-6">
                    <h4 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Correlation Matrix: Weather vs Output</h4>
                    <div class="flex justify-center">
                        <img src="{{ url_for('static', filename='img/image5.png') }}" alt="Correlation Matrix: Weather vs Output" class="max-w-full h-auto rounded" style="max-height: 600px;">
                    </div>
                    <p class="mt-4 text-lg text-gray-600">Heatmap showing correlation coefficients between weather variables and energy output, highlighting the strong positive correlation between wind speed and estimated output.</p>
                </div>
            </div>
        </div>
        
        <!-- Summary and Conclusions -->
        <div class="mt-12 text-center max-w-4xl mx-auto">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">📊 Key Findings & Future Outlook</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="font-semibold text-blue-900 mb-2">Historical Trends</h4>
                    <ul class="text-sm text-blue-800 space-y-1">
                        <li>• 340% growth in solar capacity over 5 years</li>
                        <li>• Consistent 12%+ annual growth rate</li>
                        <li>• Technology efficiency improved from 65% to 78%</li>
                        <li>• $42.8B invested, 156K jobs created</li>
                    </ul>
                </div>
                <div class="bg-green-50 p-6 rounded-lg">
                    <h4 class="font-semibold text-green-900 mb-2">Future Projections</h4>
                    <ul class="text-sm text-green-800 space-y-1">
                        <li>• Target 50% renewable by 2030</li>
                        <li>• Expected 8-10% annual growth continuation</li>
                        <li>• Battery storage integration increasing</li>
                        <li>• Grid stability improvements ongoing</li>
                    </ul>
                </div>
            </div>
            <p class="mt-6 text-lg text-gray-600">
                California's renewable energy sector demonstrates strong historical growth with technology improvements driving efficiency gains. Weather dependency remains a key factor, but diversified regional deployment and advancing storage solutions continue to enhance system reliability.
            </p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Generate sample historical data
    function generateHistoricalData() {
        const years = ['2019', '2020', '2021', '2022', '2023', '2024'];
        return {
            solar: [3200, 4100, 5800, 8200, 11400, 14100],
            wind: [5800, 6200, 6800, 7400, 8100, 8900],
            hydro: [2100, 1800, 1600, 1400, 1900, 2200],
            efficiency: [65, 68, 71, 74, 76, 78],
            investment: [4.2, 5.8, 7.1, 8.9, 9.2, 7.6]
        };
    }
    
    const data = generateHistoricalData();
    const years = ['2019', '2020', '2021', '2022', '2023', '2024'];
    
    // Chart.js default configuration
    Chart.defaults.font.family = 'system-ui, -apple-system, sans-serif';
    Chart.defaults.color = '#374151';
    
    // 1. Capacity Growth Chart
    const capacityCtx = document.getElementById('capacityGrowthChart').getContext('2d');
    new Chart(capacityCtx, {
        type: 'line',
        data: {
            labels: years,
            datasets: [{
                label: 'Solar (MW)',
                data: data.solar,
                borderColor: '#f59e0b',
                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'Wind (MW)',
                data: data.wind,
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'Hydro (MW)',
                data: data.hydro,
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Renewable Energy Capacity Growth by Source'
                },
                legend: {
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Capacity (MW)'
                    }
                }
            }
        }
    });
    
    // 2. Seasonal Performance Chart
    const seasonalCtx = document.getElementById('seasonalChart').getContext('2d');
    new Chart(seasonalCtx, {
        type: 'radar',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'Solar Output (%)',
                data: [45, 55, 75, 85, 92, 100, 98, 95, 85, 70, 50, 40],
                borderColor: '#f59e0b',
                backgroundColor: 'rgba(245, 158, 11, 0.2)',
                pointBackgroundColor: '#f59e0b'
            }, {
                label: 'Wind Output (%)',
                data: [85, 80, 75, 70, 65, 60, 58, 62, 70, 78, 82, 88],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                pointBackgroundColor: '#3b82f6'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Seasonal Performance Patterns (% of Peak)'
                }
            },
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });
    
    // 3. Efficiency Trends Chart
    const efficiencyCtx = document.getElementById('efficiencyChart').getContext('2d');
    new Chart(efficiencyCtx, {
        type: 'bar',
        data: {
            labels: years,
            datasets: [{
                label: 'Average System Efficiency (%)',
                data: data.efficiency,
                backgroundColor: 'rgba(16, 185, 129, 0.8)',
                borderColor: '#10b981',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Technology Efficiency Improvements Over Time'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    title: {
                        display: true,
                        text: 'Efficiency (%)'
                    }
                }
            }
        }
    });
    
    // 4. Regional Performance Chart
    const regionalCtx = document.getElementById('regionalChart').getContext('2d');
    new Chart(regionalCtx, {
        type: 'doughnut',
        data: {
            labels: ['Southern CA', 'Northern CA', 'Central CA'],
            datasets: [{
                label: 'Solar Capacity (%)',
                data: [60, 25, 15],
                backgroundColor: ['#f59e0b', '#fbbf24', '#fcd34d']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Regional Distribution of Solar Capacity'
                },
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
    
    // 5. Weather Impact Chart
    const weatherCtx = document.getElementById('weatherImpactChart').getContext('2d');
    new Chart(weatherCtx, {
        type: 'line',
        data: {
            labels: years,
            datasets: [{
                label: 'Drought Impact on Hydro (%)',
                data: [0, -15, -25, -32, -10, +5],
                borderColor: '#ef4444',
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                yAxisID: 'y'
            }, {
                label: 'Wind Speed Variation (%)',
                data: [0, +5, -8, +12, +28, +15],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                yAxisID: 'y'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Weather-Related Generation Variations'
                }
            },
            scales: {
                y: {
                    title: {
                        display: true,
                        text: 'Variation from Baseline (%)'
                    }
                }
            }
        }
    });
    
    // 6. Investment Chart
    const investmentCtx = document.getElementById('investmentChart').getContext('2d');
    new Chart(investmentCtx, {
        type: 'bar',
        data: {
            labels: years,
            datasets: [{
                label: 'Annual Investment ($B)',
                data: data.investment,
                backgroundColor: 'rgba(139, 92, 246, 0.8)',
                borderColor: '#8b5cf6',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Annual Renewable Energy Investment'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Investment (Billions USD)'
                    }
                }
            }
        }
    });
    
    // Filter functionality
    const filters = {
        timeRange: document.getElementById('timeRange'),
        energyType: document.getElementById('energyType'),
        region: document.getElementById('region')
    };
    
    // Add event listeners for filters
    Object.values(filters).forEach(filter => {
        filter.addEventListener('change', updateChartsWithFilters);
    });
    
    function updateChartsWithFilters() {
        // Simulate filter updates (in real implementation, this would update charts with filtered data)
        console.log('Filters updated:', {
            timeRange: filters.timeRange.value,
            energyType: filters.energyType.value,
            region: filters.region.value
        });
        
        // Update statistics based on filters
        updateStatistics();
    }
    
    function updateStatistics() {
        // Update key statistics based on current filters
        // This would be connected to real data in a production environment
        const stats = {
            avgGrowthRate: '+12.4%',
            totalCapacity: '24,847',
            efficiency: '78.2%',
            seasonalVar: '±18.7%'
        };
        
        // Update DOM elements
        document.getElementById('avgGrowthRate').textContent = stats.avgGrowthRate;
        document.getElementById('totalCapacity').textContent = stats.totalCapacity;
        document.getElementById('efficiency').textContent = stats.efficiency;
        document.getElementById('seasonalVar').textContent = stats.seasonalVar;
    }
});
</script>
{% endblock %}